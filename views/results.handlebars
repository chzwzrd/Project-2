<!DOCTYPE html>
<html lang="en-US">

<head>
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="/css/results.css">
</head>

<body>

    <div class="demo-layout mdl-layout mdl-js-layout mdl-layout--fixed-header">
        <header class="demo-header mdl-layout__header mdl-color-text--black">
            <div class="mdl-layout__header-row">
                <span class="mdl-layout-title">
                    <a href="/search">
                        <img id="logo" src="/img/puppy-logo.png" />
                    </a>PetRent</span>
                <div class="mdl-layout-spacer"></div>

                <!-- Right aligned menu below button -->
                <button id="demo-menu-lower-right" class="mdl-button mdl-js-button mdl-button--icon">
                    <i class="material-icons">menu</i>
                </button>

                <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="demo-menu-lower-right">
                    <li id="search-pg-btn" class="mdl-menu__item">Search</li>
                    <li id="my-account-btn" class="mdl-menu__item">My Account</li>
                    <li id="sign-out-btn" class="mdl-menu__item">Sign Out</li>
                </ul>
            </div>
        </header>
    </div>

    <div class="container">
        <div class="mdl-grid">
            <div id="results-div" class="mdl-cell mdl-cell--12-col">
                <h4 class="text-center">Results:</h4>
                <div id="results-container">
                    {{#each this.pets}}
                    <a class="pet-link" href="#petModal" data-name="{{this.name}}" data-description="{{this.description}}" data-breeds="{{this.breeds}}" data-options="{{this.options}}" data-sex="{{this.sex}}">
                        <div class="demo-card-square mdl-card mdl-shadow--2dp">
                            <div class="mdl-card--expand crop">
                                <img id="pet-photo" src="{{this.photo}}" />
                            </div>
                            <div class="content-div">
                                <h2 class="name-div">{{this.name}}</h2>
                                <div class="stats-div">
                                    {{this.city}}, {{this.state}}
                                    <br /> {{this.sex}} &bull; {{this.age}}
                                </div>
                            </div>
                        </div>
                    </a>

                    <!-- Modal -->
                    <div class="modal fade" id="petModal" tabindex="-1" role="dialog" aria-labelledby="petModalLabel">
                        <div class="modal-dialog" role="document">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="mdl-button close" data-dismiss="modal" aria-label="Close">
                                        {{!--
                                        <span aria-hidden="true">X</span> --}}
                                    </button>
                                    <h4 class="modal-title" id="petModalLabel"></h4>
                                </div>
                                <div class="modal-body">
                                    <p>
                                        <strong>Breeds: </strong>
                                        <span class="pet-breeds"></span>
                                    </p>
                                    <p>
                                        <strong>Description: </strong>
                                        <span class="pet-description"></span>
                                    </p>
                                    <p>
                                        <strong>Status/Preferences: </strong>
                                        <span class="pet-options"></span>
                                    </p>
                                </div>
                                <div class="modal-footer">
                                    <button id="rent-btn" type="button" class="mdl-button">Set Playdate</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    {{/each}}
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery CDN -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script>
        $(window).load(() => {

            // $("#loading").hide();
            // $("body").css("background", "#3f1097");
            // $("body").css("margin-bottom", "70px");
            // $(".page-content").show();

            // EXTRACTING DATA FROM PETS OBJECT
            // var pets = {{{toJSON this.pets}}};
            // var div = $("<div>");
            // div.html("{{#each this.pets}}<p>{{this.name}}</p>{{/each}}");
            // $("#results-container").append(div);

            // DISPLAY MODAL INFO
            $(".pet-link").on('click', function(e) {
                var modalTrigger = $(this); // Button that triggered the modal
                console.log(modalTrigger);
                var petName = modalTrigger.data('name');
                console.log(petName);
                var petBreeds = modalTrigger.data('breeds');
                var petDescription = modalTrigger.data('description');
                var petStatus = modalTrigger.data('options'); // Extract info from data-* attributes
                // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
                // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
                console.log(petName, petBreeds, petDescription, petStatus);

                var modal = $("#petModal");
                modal.find('.modal-title').text(petName);
                $('.pet-breeds').text(petBreeds);
                $('.pet-description').text(petDescription);
                $('.pet-options').text(petStatus);
                modal.modal();

                var chosenPet = {
                    name: modalTrigger.data('name'),
                    sex: modalTrigger.data('sex'),
                    photo: modalTrigger.data('photo')
                };

                $("#rent-btn").on('click', (e) => {
                    axios.get(`/rent&name=${chosenPet.name}&sex=${chosenPet.sex}`)
                        .then(response => {
                            console.log(response);
                            window.location.href = `/rent&name=${chosenPet.name}&sex=${chosenPet.sex}`;
                        })
                        .catch(err => {
                            console.error(err);
                        });
                });
            });
        });

    </script>

</body>

</html>